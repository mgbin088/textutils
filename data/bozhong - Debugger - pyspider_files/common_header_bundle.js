var FlyJSONP=function(t){"use strict";var e,n,i,o,s,r,a,l,u;return n=function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},i=function(n,i){e.log("Garbage collecting!"),i.parentNode.removeChild(i),t[n]=void 0;try{delete t[n]}catch(t){}},o=function(t,e){var n,i,o="";for(n in t)t.hasOwnProperty(n)&&(n=e?encodeURIComponent(n):n,i=e?encodeURIComponent(t[n]):t[n],o+=n+"="+i+"&");return o.replace(/&$/,"")},s=function(){var t=[],e="0123456789ABCDEF",n=0;for(n=0;n<32;n+=1)t[n]=e.substr(Math.floor(16*Math.random()),1);return t[12]="4",t[16]=e.substr(3&t[16]|8,1),"flyjsonp_"+t.join("")},r=function(t,n){e.log(n),void 0!==t&&t(n)},a=function(t,n){e.log("GET success"),void 0!==t&&t(n),e.log(n)},l=function(t,n){e.log("POST success"),void 0!==t&&t(n),e.log(n)},u=function(t){e.log("Request complete"),void 0!==t&&t()},e={},e.options={debug:!1},e.init=function(t){var n;e.log("Initializing!");for(n in t)t.hasOwnProperty(n)&&(e.options[n]=t[n]);return e.log("Initialization options"),e.log(e.options),!0},e.log=function(n){t.console&&e.options.debug&&t.console.log(n)},e.get=function(c){c=c||{};var p=c.url,h=c.callbackParameter||"callback",d=c.parameters||{},m=t.document.createElement("script"),g=s(),f="?";if(!p)throw new Error("URL must be specified!");d[h]=g,p.indexOf("?")>=0&&(f="&"),p+=f+o(d,!0),t[g]=function(t){void 0===t?r(c.error,"Invalid JSON data returned"):"post"===c.httpMethod?(t=t.query.results,t&&t.postresult?(t=t.postresult.json?t.postresult.json:t.postresult,l(c.success,t)):r(c.error,"Invalid JSON data returned")):a(c.success,t),i(g,m),u(c.complete)},e.log("Getting JSONP data"),m.setAttribute("src",p),t.document.getElementsByTagName("head")[0].appendChild(m),n(m,"error",function(){i(g,m),u(c.complete),r(c.error,"Error while trying to access the URL")})},e.post=function(t){t=t||{};var n,i,s=t.url,r=t.parameters||{},a={};if(!s)throw new Error("URL must be specified!");n=encodeURIComponent('select * from jsonpost where url="'+s+'" and postdata="'+o(r,!1)+'"'),i="http://query.yahooapis.com/v1/public/yql?q="+n+"&format=json&env="+encodeURIComponent("store://datatables.org/alltableswithkeys"),a.url=i,a.httpMethod="post",void 0!==t.success&&(a.success=t.success),void 0!==t.error&&(a.error=t.error),void 0!==t.complete&&(a.complete=t.complete),e.get(a)},e}(this);window.GeetestBZ=function(){var t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");return this.abled={},this.abled.geetest=!0,this.abled.style=!0,this.captchaObj={},this.token={},this.auth={},this.bbsURL=this.getSiteUrl(t.match(/(lyc|wcl).bzdev.net/)?"api.bbs":"bbs"),this},GeetestBZ.prototype.getToken=function(t,e,n){var i=this;jQuery.ajax({type:"get",url:this.bbsURL+"/restful/misc/token.jsonp",dataType:"jsonp",jsonp:"__c",data:{type:"geetest"},success:function(o){0===o.error_code?(i.token[t]=o.data.token,!!e&&e(o)):!!n&&n(o)},error:function(t){!!window.console&&window.console("网络异常，misc/token")}})},GeetestBZ.prototype.getGeetestAuth=function(t,e,n){var i=this;jQuery.ajax({type:"get",url:this.bbsURL+"/restful/misc/geetest.jsonp",dataType:"jsonp",jsonp:"__c",data:{token:i.token[t]},xhrFields:{withCredentials:!0},success:function(o){0===o.error_code?(i.auth[t]=o.data,e&&e(o)):n&&n(o)},error:function(){!!window.console&&window.console("网络异常，misc/geetest")}})},GeetestBZ.prototype.sign=function(t,e){var n=this;if(!window.initGeetest)return void(window.console&&console.error("geetest的js没有引入"));!this.captchaObj[t]&&t?initGeetest({gt:this.auth[t].gt,challenge:this.auth[t].challenge,product:t,offline:!this.auth[t].success},function(i){n.captchaObj[t]=i,e&&e(i)}):e&&e(this.captchaObj[t])},GeetestBZ.prototype.getSiteUrl=function(t,e){e=e||document.location.host;var n=e.split(".");return n.length>=3&&(n=n.slice(1)),[window.location.protocol+"//"+t].concat(n).join(".")},GeetestBZ.prototype.init=function(t,e,n){if(!window.initGeetest){var i=document.createElement("script");i.src="//static.geetest.com/static/tools/gt.js",document.getElementsByTagName("head")[0].appendChild(i)}if(this.abled.style){this.abled.style=!1;var o=document.createElement("style");o.innerHTML=".gt_holder.popup .gt_mask { z-index: 300; }",document.getElementsByTagName("head")[0].appendChild(o)}var s=this;this.token[t]?this.auth[t]?e&&e():s.getGeetestAuth(t,e,n):this.getToken(t,function(i){s.auth[t]?e&&e():s.getGeetestAuth(t,e,n)},function(t){n&&n(),!!window.console&&console.log(t)})},GeetestBZ.prototype.getCaptchaObj=function(t,e,n){var i=this;this.captchaObj[t]?e&&e(this.captchaObj[t]):this.init(t,function(){i.sign(t,e)},n)},window.geetestObj||(window.geetestObj=new GeetestBZ);var log=function(){function t(t){var e="_rpLog-"+(new Date).getTime(),n=new Image;window[e]=n,n.onload=n.onerror=function(){window[e]=null},n.src=t,n=null}function e(t,e){var n,i=t||{};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function n(n,i,o){var s,r={logid:0,version:0,prod_id:"rp",plate_url:encodeURIComponent(window.location.href),referrer:encodeURIComponent(document.referrer),time:(new Date).getTime()},a=r,l=[],u=n;"?"!==u.charAt(u.length-1)&&(u+="?");for(var c=1,p=arguments.length;c<p;c++)"[object Object]"===Object.prototype.toString.call(arguments[c])&&(a=e(a,arguments[c]));for(var s in a)l.push(s+"="+a[s]);t(u+l.join("&")),"[object Function]"===Object.prototype.toString.call(arguments[arguments.length-1])&&arguments[arguments.length-1].call()}return{send:n}}(),Sug=function(){function t(t,e){var n,i=t||{};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function e(t){return!(""!=t&&!t.match(/^\s+$/))}function n(t,e,n){document.addEventListener?t.addEventListener(e,n,!1):document.attachEvent&&t.attachEvent("on"+e,function(e){e.preventDefault=function(){e.returnValue=!1},e.stopPropagation=function(){e.cancelBubble=!0},n.call(t,e)})}function i(t){return t.replace(/-([\da-z])/gi,function(t,e){return(e+"").toUpperCase()})}function o(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function s(){var t=document.createElement("div");return t.style.cssText="float:left",t.style.cssFloat?"cssFloat":"styleFloat"}function r(t,e){var n="float"===e?s():i(e),r=o(e);return t.style.inlineName?t.style[n]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null).getPropertyValue(r):t.currentStyle?t.currentStyle[n]:null}function a(t,e){var n,o;for(n in e)e.hasOwnProperty(n)&&(o="float"===n?s():i(n),t.style[o]=e[n])}function l(t){for(var e=0,n=0;t;)e+=t.offsetTop,n+=t.offsetLeft,t=t.offsetParent;return{top:e,left:n}}function u(t){var e,n,i=document.createElement("div");return i.style.cssText="position: absolute; top: 0; left: 0",document.body.appendChild(i),e=i.getBoundingClientRect().top,n=i.getBoundingClientRect().left,document.body.removeChild(i),i=null,{top:t.getBoundingClientRect().top-e,left:t.getBoundingClientRect().left-n,bottom:t.getBoundingClientRect().bottom-e,right:t.getBoundingClientRect().right-n}}function c(t){if(t)return t.replace(/^\s+|\s+$/g,"")}function p(t){if(t)return t.replace(/\s+/g," ")}function h(t,e){var n,i,o=e;if("string"==typeof e&&(o=o.split(" ")),1===t.nodeType)if(t.className||1!==o.length)for(var s=0,r=o.length;s<r;s++)n=o[s],i=new RegExp("\\b("+n+")\\b"),i.test(t.className)||(t.className=t.className+" "+n);else t.className=o[0];t.className=c(t.className),t.className=p(t.className)}function d(t,e){var n,i,o=e;if("string"==typeof e&&(o=o.split(" ")),1===t.nodeType&&t.className)for(var s=0,r=o.length;s<r;s++)n=o[s],i=new RegExp("\\b("+n+")\\b"),i.test(t.className)&&(t.className=t.className.replace(i," "));t.className=c(t.className)||"",t.className=p(t.className)||""}function m(t,e){var n=" "+e+" ",i=/[\t\r\n]/g;return 1===t.nodeType&&(" "+t.className+" ").replace(i," ").indexOf(n)>=0}function g(t,e){if(e=e||document,e.getElementsByClassName)return e.getElementsByClassName(t);for(var n=[],i=e.getElementsByTagName("*"),o=new RegExp("(^|\\s)"+t.replace(/\-/g,"\\-")+"(\\s|$)"),s=0,r=i.length;s<r;s++)o.test(i[s].className)&&n.push(i[s]);return n}function f(t,e,i,o){n(t,e,function(e){for(var n=e.target||e.srcElement;!m(n,i)&&n!=t;)n=n.parentNode;m(n,i)&&o.call(n,e)})}function v(t,e){var n=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):w[t]=w[t]||v(document.getElementById(t).innerHTML);return e?n(e):n}function y(e){var n={sugListBorderWidth:1,offset:{top:0,left:0},type:"",dataType:"jsonp",delay:150,completeWhenKeyUpDown:!1};this.options=t(n,e||{}),this.dataCache={},this.selectedIndex=-1,this.inputTimer,this.intervalTimer,this.preValue,this.valueCache,this.init()}String.prototype.trim||(String.prototype.trim=function(t){return this.replace("/^s+|s+$/g","")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){for(var n=e||0,i=this.length;n<i;n++)if(this[n]===t)return n;return-1});var w,E=function(){for(var t=3,e=document.createElement("div"),n=e.getElementsByTagName("i");e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",n[0];);return t>4?t:void 0}();return y.prototype.init=function(){switch(this.setStyle(),this.options.type){case"input":this.bindInputEvent();break;case"interval":this.bindIntervalEvent()}this.bindSugListItemEvent()},y.prototype.bindInputEvent=function(){var t=this.options.inputElem,i=this,o=this.keydownHandler(),s=(this.keyupHandler(),this.inputHandler());n(t,"keydown",o),n(t,"input",s),n(t,"propertychange",s),n(t,"blur",function(t){9==E&&("focus"===t.type?document.addEventListener("selectionchange",s,!1):document.removeEventListener("selectionchange",s,!1)),setTimeout(function(){i.hideSugList()},i.options.delay)}),n(t,"focus",function(t){setTimeout(function(){i.prepareSug()},i.options.delay),9==E&&("focus"===t.type?document.addEventListener("selectionchange",s,!1):document.removeEventListener("selectionchange",s,!1))}),n(this.options.sugListElem,"mouseout",function(){i.selectedIndex=-1}),n(this.options.submitElem,"click",function(t){e(i.getCurrentValue())&&t.preventDefault()})},y.prototype.bindIntervalEvent=function(){var t=this.options.inputElem,i=this,o=this.keydownHandler();this.inputHandler();n(t,"focus",function(t){i.intervalTimer&&clearInterval(i.intervalTimer),i.intervalTimer=setInterval(function(){i.prepareSug()},100)}),n(t,"blur",function(t){i.intervalTimer&&clearInterval(i.intervalTimer),setTimeout(function(){i.hideSugList()},i.options.delay)}),n(t,"keydown",o),n(this.options.sugListElem,"mouseout",function(){i.selectedIndex=-1}),n(this.options.submitElem,"click",function(t){e(i.getCurrentValue())&&t.preventDefault()})},y.prototype.bindSugListItemEvent=function(){var t=this;f(this.options.sugListElem,"mouseover",this.options.itemClassName,function(e){e.target||e.srcElement;t.clearCurrent(),h(this,t.options.currentClassName),t.selectedIndex=this.getAttribute("data-index")}),f(this.options.sugListElem,"mouseout",this.options.itemClassName,function(e){e.target||e.srcElement;t.clearCurrent()}),f(this.options.sugListElem,"click",this.options.itemClassName,function(){t.selectCurrent(),t.submit()})},y.prototype.setStyle=function(){var t=this.options.inputElem,e=u(this.options.inputElem);t.setAttribute("autocomplete","off"),this.options.inputElemOuterHeight=e.bottom-e.top,this.options.inputElemOuterWidth=e.right-e.left,this.options.inputElemOffset=l(this.options.inputElem),a(this.options.sugListElem,{top:this.options.inputElemOffset.top+this.options.inputElemOuterHeight+this.options.offset.top-this.options.sugListBorderWidth+"px",left:this.options.inputElemOffset.left+this.options.offset.left+"px",width:this.options.sugListWidth?parseInt(this.options.sugListWidth)+"px":this.options.inputElemOuterWidth-2*this.options.sugListBorderWidth+"px"})},y.prototype.keydownHandler=function(){var t=this;return function(e){switch(e.keyCode){case 27:t.hideSugList();break;case 38:t.selectPrev();break;case 40:t.selectNext();break;case 13:t.selectCurrent(),t.submit();break;default:return}e.stopPropagation(),e.preventDefault()}},y.prototype.keyupHandler=function(){var t=this;return function(e){switch(e.keyCode){case 27:case 38:case 40:return}t.startSug()}},y.prototype.inputHandler=function(){var t=this;return function(){t.startSug()}},y.prototype.startSug=function(){var t=this;this.inputTimer&&clearTimeout(this.inputTimer),this.inputTimer=setTimeout(function(){t.prepareSug()},this.options.delay)},y.prototype.getCurrentValue=function(){return this.options.inputElem.value},y.prototype.prepareSug=function(){var t=this.getCurrentValue();t!=this.preValue?(this.preValue=t,this.selectedIndex=-1,e(t)?this.hideSugList():(this.valueCache=t,void 0===this.dataCache[t]?this.getData(t):this.renderSugList(t))):e(t)},y.prototype.getData=function(t){var e=this,n=this.options.url,i="",o=this.options.data||{};for(var s in o)o.hasOwnProperty(s)&&(i+="&"+s+"="+o[s]);n=n.indexOf("?")>=0?this.options.url+"&"+this.options.param+"="+t+i:this.options.url+"?"+this.options.param+"="+t+i,FlyJSONP.get({url:n,success:function(n){e.cacheData(t,n.data),e.renderSugList(t)}})},y.prototype.cacheData=function(t,e){e.sug?this.dataCache[t]=e.sug:this.dataCache[t]=e},y.prototype.clearDataCache=function(t){t?this.dataCache[t]=null:this.dataCache=null},y.prototype.renderSugList=function(t,e){if(t){e=void 0==e?-1:e;var n=this.dataCache[t];if(n&&n.length>0){var i=v(this.options.tmplString,{data:n,selectedIndex:e,limit:n.length>this.options.sugListItemLimit?this.options.sugListItemLimit:n.length});this.options.sugListElem.innerHTML=i,this.showSugList()}else this.hideSugList()}},y.prototype.dispose=function(){},y.prototype.hideSugList=function(){this.options.sugListElem.style.display="none",this.getCurrentValue().length>0?(this.preValue=this.valueCache,this.valueCache=this.getCurrentValue()):(this.preValue="",this.valueCache=""),this.preValue="",this.selectedIndex=-1},y.prototype.showSugList=function(){var t=this.options.sugListElem;t.getElementsByTagName("li").length>0&&(t.style.display="block")},y.prototype.isShowSugList=function(){return"none"!=r(this.options.sugListElem,"display")},y.prototype.selectNext=function(){var t,e,n;if(this.isShowSugList()&&(t=this.options.sugListElem,e=t.getElementsByTagName("li").length,this.selectedIndex==e-1?this.selectedIndex=-1:++this.selectedIndex,n=t.getElementsByTagName("li")[this.selectedIndex],this.clearCurrent(),n&&h(n,this.options.currentClassName),this.options.completeWhenKeyUpDown))if(-1==this.selectedIndex)this.options.inputElem.value=this.valueCache,this.preValue=this.valueCache;else{var i=g(this.options.valueClassName,n)[0].innerHTML;this.preValue=i,this.options.inputElem.value=i}},y.prototype.selectPrev=function(){var t,e,n;if(this.isShowSugList()&&(t=this.options.sugListElem,e=t.getElementsByTagName("li").length,-1==this.selectedIndex?this.selectedIndex=e-1:--this.selectedIndex,n=t.getElementsByTagName("li")[this.selectedIndex],this.clearCurrent(),n&&h(n,this.options.currentClassName),this.options.completeWhenKeyUpDown))if(-1==this.selectedIndex)this.options.inputElem.value=this.valueCache,this.preValue=this.valueCache;else{var i=g(this.options.valueClassName,n)[0].innerHTML;this.preValue=i,this.options.inputElem.value=i}},y.prototype.clearCurrent=function(){for(var t=g(this.options.currentClassName),e=0,n=t.length;e<n;e++)d(t[e],this.options.currentClassName)},y.prototype.getSelectedItem=function(){var t=this.options.sugListElem;return this.isShowSugList?g(this.options.currentClassName,t)[0]:null},y.prototype.selectCurrent=function(){var t=this.getSelectedItem();t&&(this.options.inputElem.value=g(this.options.valueClassName,t)[0].innerHTML,this.hideSugList(),this.options.inputElem.blur())},y.prototype.submit=function(){var t={version:"1.0",prod_id:"cse",page_id:"content_page",source:"new",site_id:this.options.data.sid};log.send("http://znsv.baidu.com/customer_search/click",t,{query:encodeURIComponent(this.getCurrentValue()),search_type:"sug",sb:"cse"}),e(this.getCurrentValue())||this.options.formElem.submit()},y}();